\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{bibliocaiera}[2025-12-16 Bibliocaiera]

\newcommand{\selection}{selection={recorded and deps and see}}
\DeclareOption{all}{\renewcommand{\selection}{selection=all}}
\ProcessOptions\relax

\RequirePackage[backend=biber,
	style=./biblatex/abnt-caio, language=brazil,
	pretty, autolang=hyphen,
	pretty, repeatfields, noslsn, natbib, extrayear, giveninits
]{biblatex}
\addbibresource{./biblio.bib}
\RequirePackage{emoji}

\RequirePackage[record,index,section,nomain,style=mcolalttree,stylemods={mcols,bookindex}]{glossaries-extra}
\newglossary*{abbreviation}{Abreviações}
\newglossary*{authwork}{Autores e obras antigos}
\newglossary*{passagens}{Autores, obras e passagens citadas}
\newglossary*{lang}{Línguas}
\newglossary*{linguas}{Línguas}
\newglossary*{gram}{Glosas}
\newglossary*{acronym}{Acrônimos}

\GlsXtrLoadResources[
	src={gloss},
	sort={pt-BR},
	match={entrytype={abbreviation}},
	type={same as category},
	\selection%
]
\GlsXtrLoadResources[
	src={acronyms},
	sort={pt-BR},
	type=acronym,
	\selection%
]
% \GlsXtrLoadResources[
% 	src={./authors},
% 	sort={pt-BR},
% 	type=authwork,
% 	\selection%
% ]
\GlsXtrLoadResources[
	src={./abbrev},
	sort={pt-BR},
	type=abbreviation,
	\selection%
]


\GlsXtrLoadResources[
	src={authors,passagens},
	set-widest,
	type=passagens,
	label-prefix={idx.},
	dual-prefix={},
	cs-label-prefix={},
	combine-dual-locations={primary},
	dual-field,
	sort={letternumber-case},
	sort-field={name},
	dual-type={same as category},
	dual-sort={en},
	dual-sort-number-pad={2},
	dual-sort-pad-plus={1},
	dual-sort-pad-minus={0},
	dual-break-at=upper-upper-word,
	entry-type-aliases={
			abbreviation=dualindexabbreviation,
			entry=dualindexentry,
			acronym=acronym,
			passage=index
		},
	abbreviation-name-fallback={long},
	custom-sort-fallbacks={passage=useriii},
	symbol-sort-fallback={name},
	\selection%
]

\newcommand{\passagemcorpus}[1]{\gls{idx.#1} = \glsentryuseri{idx.#1}}
\newcommand{\passagem}[1]{\gls{idx.#1}}


\GlsXtrLoadResources[
	src={linguas},
	set-widest,
	type=linguas,
	label-prefix={idx.},
	dual-prefix={},
	cs-label-prefix={},
	combine-dual-locations={primary},
	dual-field,
	sort={pt-BR},
	sort-field={name},
	dual-type={same as category},
	dual-sort={pt-BR},
	dual-sort-number-pad={2},
	dual-sort-pad-plus={1},
	dual-sort-pad-minus={0},
	dual-break-at=upper-upper-word,
	entry-type-aliases={
			lingua=dualindexabbreviation
		},
	abbreviation-name-fallback={long},
	\selection%
]
